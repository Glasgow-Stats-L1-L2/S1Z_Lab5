[["index.html", "S1Z Lab 5 - Logistic Regression 1 Welcome to S1Z Lab 5 - Logistic Regression 1.1 Intended Learning Outcomes: 1.2 An Introdution to Logistic Regression Modeling", " S1Z Lab 5 - Logistic Regression 1 Welcome to S1Z Lab 5 - Logistic Regression 1.1 Intended Learning Outcomes: Build a logistic regression model for the risk of heart disease. Interpret the coefficients of this model Calculate the odds and probabilities of heart disease risk from this model 1.2 An Introdution to Logistic Regression Modeling This lab will explore the concept of modelling data using logistic regression. Logistic regression is a type of Generalized Linear Model (GLM) which allows us to build models when there is a categorical response variable with two levels, e.g. yes and no. The key idea behind this is to attempt to explore a relationship between a: Binary response variable \\(Y_i\\), and Explanatory/predictor variables \\(x_i\\). To model a binary response, we use the Logit Function which is the log-odds of \\(p_i\\) (the probability of \"success\" for outcome \\(i\\)) to transform our response variable. This gives the formula for a logistic regression model as: \\[\\boxed{g(p)=log(\\frac{p_i}{1-p_i})=\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki}}\\] Once fit well, we can use these models for predictions of the response variable and find the odds of \\(p_i\\): \\[\\frac{p_i}{1-p_i}=exp(\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki})\\] and/or \\(p_i\\) itself: \\[p_i=\\frac{exp(\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki})}{1+exp(\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki})}\\] "],["introducing-the-data.html", "2 Introducing the Data", " 2 Introducing the Data Today we will explore the variables that contribute to heart disease. We will be looking at data from an ongoing cardiovascular study on residents of the town of Framingham, Massachusetts. The goal is to predict the probability of a patient developing coronary heart disease (CHD) over the next ten years based on multiple explanatory variables. The dataset provides the patients’ information. It includes over 4,000 records and 7 attributes. Load the HEARTDISEASE data set into your workspace by typing the following code in an Rscript file in your local Rstudio. HEARTDISEASE&lt;-read.csv(url(&quot;https://raw.githubusercontent.com/Glasgow-Stats-L1-L2/S1Z_Lab5/main/HEARTDISEASE.csv&quot;)) You may also download the dataset named HEARTDISEASE.csv file from our Moodle course page. Save the file in your local computer and then use the read.csv() function to import the data in your R. You can load the data set into your workspace by running the code below in an Rscript file in your local Rstudio. Make sure that the HEARTDISEASE.csv file is saved in the same folder as the Rscript file. The 7 variables are: male : Sex of the patient (Nominal - male = 1 or female = 0) age : Age of the patient (Continuous - Although the recorded ages have been truncated to whole numbers, the concept of age is continuous). education : Years of schooling of the patient (Continuous - Although the recorded years have been truncated to whole numbers, the concept of years is continuous) cigsPerDay : The number of cigarettes that the person smoked on average in one day (Continuous - the recorded cigarettes have been truncated to whole numbers but can be considered continuous as one can have part cigarettes) diabetes : Whether or not the patient had diabetes (Nominal - No = 0 or Yes = 1) sysBP : Systolic blood pressure (Continuous) TenYearCHD :10 year risk of CHD, i.e. whether a patient developed coronary heart disease over the next 10 years (Binary - Yes = 1 or No = 0) First of all, it is always a good idea to look at the dataset you are working with. Copy and run the code below to look at the first 6 rows of data and the structure of it. head(HEARTDISEASE) str(HEARTDISEASE) How many observations/rows are there in the entire data set? Hint Look again at the result of the str() function. It is also worth checking if there are missing values in this data set. To find how many observations we are missing from the weight variable you can run the following R code: sum(is.na(HEARTDISEASE)) ## [1] 0 The is.na() function creates a vector that corresponds to the variable provided, with TRUE for a missing value and FALSE for a non-missing value. The sum() function then adds up the elements in this created vector such that TRUE is equivalent to 1 and FALSE is equivalent to 0 and hence the sum of this vector is equivalent to the number of TRUE entries which calculates how many of these \"NA\" values there are. How many observations are we missing from the dataset? We can remove observations with missing values and create a data set without these using the code below: HEARTDISEASE &lt;- na.omit(HEARTDISEASE) How many observations/rows are there in the new entire data set (with missing values removed)? We could investigate the number of people in the trial. For the categorical data of sex, table() and prop.table() can be handy. sextable &lt;- table(HEARTDISEASE$male) sextable ## ## 0 1 ## 2310 1747 prop.table(sextable) ## ## 0 1 ## 0.5693862 0.4306138 We can expand the use of tables to separate by men and women with risk of heart disease. sex_heartdisease_table &lt;- table(HEARTDISEASE$male, HEARTDISEASE$TenYearCHD, dnn = c(&quot;male&quot;,&quot;TenYearCHD&quot;)) sex_heartdisease_table ## TenYearCHD ## male 0 1 ## 0 2020 290 ## 1 1420 327 prop.table(sex_heartdisease_table, margin = 1) ## TenYearCHD ## male 0 1 ## 0 0.8744589 0.1255411 ## 1 0.8128220 0.1871780 #this sums the proportion to 1 across the rows. margin=2 would change this to across the columns. What proportion of women were at risk of heart disease risk after 10 years (to 2 decimal places)? % What proportion of men were at risk of heart disease risk after 10 years (to 2 decimal places)? % For when working with a combination of continuous varibales like age and a binary variable like TenYearCHD, box plots can be useful. ggplot(HEARTDISEASE, aes(x = TenYearCHD, y = age, fill = as.factor(TenYearCHD))) + geom_boxplot() + labs(x = &quot;Heart Disease Risk&quot;, y = &quot;Age&quot;, fill = &quot;Heart Disease&quot;) From the boxplot, do the patients with ten year risk of heart disease appear to have a higher or lower median age? Higher Lower "],["modelling-our-data.html", "3 Modelling our Data", " 3 Modelling our Data We would like to fit a model that estimates using multiple explanatory variables. Our response variable is the binary variable TenYearCHD: whether a patient developed coronary heart disease over the following 10 years, where Yes=0 and No =1. What distribution do we expect our response variable to take? Normal Distribution Binomial Distribution Exponential Distribution As our response is a categorical variable we will need to use a generalized linear mixed model (GLM), specifically one with a logit function as our response is binary (0 or 1) and therefore we can assume binomially distributed. \\[\\boxed{g(p)=log(\\frac{p_i}{1-p_i})=\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki}}\\] The code to build and view a model that uses all 6 variables to predict the log odds of ten-year CHD is: logistic_model &lt;- glm(TenYearCHD~male+age+education+cigsPerDay+diabetes+sysBP ,family = &quot;binomial&quot;, data = HEARTDISEASE) summary(logistic_model) ## ## Call: ## glm(formula = TenYearCHD ~ male + age + education + cigsPerDay + ## diabetes + sysBP, family = &quot;binomial&quot;, data = HEARTDISEASE) ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -8.082293 0.411671 -19.633 &lt; 2e-16 *** ## male 0.454730 0.099555 4.568 4.93e-06 *** ## age 0.068942 0.006123 11.260 &lt; 2e-16 *** ## education -0.012474 0.046049 -0.271 0.786472 ## cigsPerDay 0.021393 0.003945 5.422 5.88e-08 *** ## diabetes 0.734689 0.222135 3.307 0.000942 *** ## sysBP 0.017468 0.002035 8.585 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 3459.0 on 4056 degrees of freedom ## Residual deviance: 3081.7 on 4050 degrees of freedom ## AIC: 3095.7 ## ## Number of Fisher Scoring iterations: 5 Looking the p-values for each variable, do you think there are any that are not significant predictors of CHD that could be removed from the model? Task 1 Using the code above try to make the model again but with only the variables that you think are significant: Solution Since the variable education does not seem to be a significant predictor of ten-year CHD risk, we could build the model without it. logistic_model2 &lt;- glm(TenYearCHD~male+age+cigsPerDay+diabetes+sysBP ,family = &quot;binomial&quot;, data = HEARTDISEASE) summary(logistic_model2) Lets use the following model to learn more about CHD risk: CHD_model &lt;- glm(TenYearCHD~male+age+cigsPerDay+diabetes+sysBP ,family = \"binomial\", data = HEARTDISEASE) First, let's use the summary() function to produce a summary of the model output. summary(CHD_model) ## ## Call: ## glm(formula = TenYearCHD ~ male + age + cigsPerDay + diabetes + ## sysBP, family = &quot;binomial&quot;, data = HEARTDISEASE) ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -8.123299 0.383131 -21.202 &lt; 2e-16 *** ## male 0.454482 0.099544 4.566 4.98e-06 *** ## age 0.069155 0.006072 11.388 &lt; 2e-16 *** ## cigsPerDay 0.021422 0.003943 5.432 5.56e-08 *** ## diabetes 0.735988 0.222072 3.314 0.000919 *** ## sysBP 0.017510 0.002029 8.631 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 3459.0 on 4056 degrees of freedom ## Residual deviance: 3081.8 on 4051 degrees of freedom ## AIC: 3093.8 ## ## Number of Fisher Scoring iterations: 5 Task 2 Based on this output, what is the equation of the logistic regression model? (Answers to 3 decimal places) \\(log(\\frac{p_i}{1-p_i})\\) = -7.9440.377-21.054 + 0.4570.377-7.944 male + 0.066 agecigsPerDaydiabetes + -7.9440.0040.021 cigsPerDay + 0.783 agecigsPerDaydiabetes + 0.0020.0170.020 sysBP "],["interpreting-our-model.html", "4 Interpreting our model 4.1 Interpreting Coefficients 4.2 Calculating Odds 4.3 Calculating probabilities", " 4 Interpreting our model \\[\\boxed{\\begin{align} log \\left( \\frac{p_i}{1-p_i} \\right) &amp;= -7.944 + 0.457 \\text{ male} + 0.066 \\text{ age} + 0.021 \\text{ cigsPerDay}\\\\&amp; \\hspace{0.5cm} + 0.783 \\text{ diabetes} + 0.017 \\text{ sysBP}\\end{align}}\\] 4.1 Interpreting Coefficients Now we have a model equation, we can investigate the model coefficients. Our model estimates the log-odds, \\(log \\left( \\frac{p_i}{1-p_i} \\right)\\), of developing CHD in the next 10-years. The \\(\\beta_i\\) coefficients are log odds ratios, however given that these are on the log scale they are not particularly intuitive to interpret. Instead we can take the exponential, \\(\\exp(\\beta_i)\\), to get the odds ratio. For example, for the variable male, the odds ratio is: exp(0.457) ## [1] 1.579329 This tells us that the odds of getting diagnosed with heart disease in the next 10 years for males over that for females, when all other variables are held constant, is \\(\\exp(0.457) = 1.579\\). In terms of percent change, we can say that the odds of CHD diagnosis in the next 10 years for males are 57.9% higher than the odds for females. For the variable age, the odds ratio is: exp(0.066) ## [1] 1.068227 This means that, holding all other variables constant, we will see 7% increase in the odds of getting diagnosed with CHD in the next 10 years for a one year increase in age since \\(\\exp(0.066) = 1.068\\) Complete the following sentence for the interpretation of the coefficient for cigsPerDay: There is a 4%2%8% increasedecrease in the odds of getting diagnosed with CHD for being a smokereach extra cigarette smoked per day when all other variables are constantzero since exp()= Solution For the variable cigsPerDay: exp(0.021) ## [1] 1.021222 4.2 Calculating Odds Odds are another way of quantifying the probability of an event and are calculated as \\(\\mbox{odds}=\\frac{p}{1-p}\\). In logistic regression, we model the log-odds \\(\\left( \\log \\frac{p_i}{1-p_i} \\right)\\). We can therefore calculate the odds by taking the exponential of the model equation: \\[\\boxed{ \\begin{align} \\frac{p_i}{1-p_i}&amp;=exp(\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki})\\\\ &amp;= exp(-7.944 + 0.457 \\text{ male} + 0.066 \\text{ age} + 0.021 \\text{ cigsPerDay} \\\\&amp; \\hspace{0.5cm}+ 0.783 \\text{ diabetes} + 0.017 \\text{ sysBP}) \\end{align}}\\] We can work out the odds of CHD risk for a 42 year old male patient who smokes 15 cigarettes per day, does not have diabetes and has a systolic blood pressure of 190 as: exp(-7.944 + 0.457*1 + 0.066*42 + 0.021*15 + 0.783*0 + 0.017*190) ## [1] 0.3103669 Therefore the odds of a person with these characteristics developing CHD over 10-years is 0.310. As a fractional odds \\(0.310 = 310/1000\\) so for every 1000 people with these characteristics who would not develop CHD over 10 years, another 310 people would. For the following patients, work out the odds of CHD risk (give any answers to 3 decimal places): Patient 1: male aged 33 0 cigarettes per day has diabetes systolic blood pressure of 90 The odds are . For every 1000 people with these characteristics who would not have a 10 year CHD risk, people would. Solution exp(-7.944 + 0.457*1 + 0.066*33 + 0.021*0 + 0.783*1 + 0.017*90) ## [1] 0.04998662 Patient 2: female aged 60 0 cigarettes per day does not have diabetes systolic blood pressure of 160 The odds are . For every 1000 people with these characteristics who would not have a 10 year CHD risk, people would. Solution exp(-7.944 + 0.457*0 + 0.066*60 + 0.021*0 + 0.783*0 + 0.017*160) ## [1] 0.2825217 4.3 Calculating probabilities To find predicted probabilities from our model we can take the inverse of the logit function: \\[\\boxed{\\begin{align} p_i&amp;=\\frac{exp(\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki})}{1+exp(\\beta_0+\\beta_1x_{1i}+...+\\beta_kx_{ki})}\\\\ &amp;=\\frac{exp(-7.944 + 0.457 \\text{ male } + ... + 0.017 \\text{ sysBP})}{1+exp(-7.944 + 0.457 \\text{ male } + ... + 0.017 \\text{ sysBP})} \\end{align}}\\] We can work out the probability of 10 year CHD risk for the 3 patients discussed above. For a 42 year old male patient who smokes 15 cigarettes per day, does not have diabetes and has a systolic blood pressure of 190: exp(-7.944 + 0.457*1 + 0.066*42 + 0.021*15 + 0.783*0 + 0.017*190)/(1+exp(-7.944 + 0.457*1 + 0.066*42 + 0.021*15 + 0.783*0 + 0.017*190)) ## [1] 0.236855 So the probability of having a ten-year CHD risk for a patient with these characteristics is 23.7%. For the other two patients, work out the probability of CHD risk (give any answers as a percentage to 1 decimal place): Patient 1: male aged 33 0 cigarettes per day has diabetes systolic blood pressure of 90 The probability of having a ten-year CHD risk for a patient with these characteristics is %. Solution exp(-7.944 + 0.457*1 + 0.066*33 + 0.021*0 + 0.783*1 + 0.017*90)/(1+exp(-7.944 + 0.457*1 + 0.066*33 + 0.021*0 + 0.783*1 + 0.017*90)) ## [1] 0.04760691 Patient 2: female aged 60 0 cigarettes per day does not have diabetes systolic blood pressure of 160 The probability of having a ten-year CHD risk for a patient with these characteristics is %. Solution exp(-7.944 + 0.457*0 + 0.066*60 + 0.021*0 + 0.783*0 + 0.017*160)/(1+exp(-7.944 + 0.457*0 + 0.066*60 + 0.021*0 + 0.783*0 + 0.017*160)) ## [1] 0.2202861 "],["group-exercise.html", "5 Group Exercise 5.1 Tasks", " 5 Group Exercise In the group exercise today, we will explore the variables that contribute to diabetes. The data was collected and made available by “National Institute of Diabetes and Digestive and Kidney Diseases” as part of the Pima Indians Diabetes Database. All patients belong to the Pima Indian heritage (subgroup of Native Americans), and are females of ages 21 and above. The goal is to build a model that can explain the occurrence of diabetes in a patient from a selection of collected variables. The dataset provides the patients’ information. It includes over 750 records and 6 attributes. Pregnancies : Number of times the patient has been pregnant (Numerical - integer) Glucose : Plasma glucose concentration after 2 hours in an oral glucose tolerance test (Numerical - integer). BloodPressure : Diastolic blood pressure (mm Hg) (Numerical - integer) DiabetesPedigreeFunction : An existing function that measures genetic influence that estimates the likelihood of diabetes based on the subject’s age and diabetic family history (Continuous) age : Age of the patient (Continuous - Although the recorded ages have been truncated to whole numbers, the concept of age is continuous). Outcome : Binary variable of whether a patient has diabetes or not (Binary - Yes = 1 or No = 0) Load the DIABETES data set into your workspace by typing the following code in an Rscript file in your local Rstudio. DIABETES&lt;-read.csv(url(&quot;https://raw.githubusercontent.com/Glasgow-Stats-L1-L2/S1Z_Lab5/main/DIABETES.csv&quot;)) You may also download the dataset named DIABETES.csv file from our Moodle course page. Save the file in your local computer and then use the read.csv() function to import the data in your R. You can load the data set into your workspace by running the code below in an Rscript file in your local Rstudio. Make sure that the DIABETES.csv file is saved in the same folder as the Rscript file. 5.1 Tasks Remove missing values from the data set and then produce a boxplot of to investigate whether patients with diabetes appear to have higher plasma glucose concentration after 2 hours in an oral glucose tolerance test. Fit the full model using Outcome as the response variable and all the remaining collected variables as explanatory variables. Refine the model by removing the variable with the largest p-value and re-evaluating the summary and repeat until all predictors are significant. Write down the equation of your refined model. Calculate the odds ratio of the variable Glucose and interpret it in context. Repeat this for the variable Pregnancies. For the following two patients, find out the odds of that patient having diabetes and the corresponding probability \\(p_i\\). Interpret both in context. Patient 1 1 pregnancy a glucose concentration of 73 a diabetes pedigree function of 0.124 Patient 2 3 pregnancies a glucose concentration of 145 a diabetes pedigree function of 0.891 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
